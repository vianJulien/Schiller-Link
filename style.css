/* CSS Variables & Theme Logic */
:root { 
    --bg: #ffffff; --card: #f6f8fa; --border: #d0d7de; --text: #24292f; --text-sub: #57606a;
    --accent: #0969da; --accent-bg: rgba(9, 105, 218, 0.1); --user: #0969da; --user-text: #ffffff;
    --ai: #f6f8fa; --nav-bg: rgba(255,255,255,0.95); --header-bg: rgba(255,255,255,0.95);
    --shadow: 0 1px 3px rgba(0,0,0,0.12);
}

body.dark-mode {
    --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #c9d1d9; --text-sub: #8b949e;
    --accent: #58a6ff; --accent-bg: rgba(88,166,255,0.15); --user: #1f6feb; --user-text: #ffffff;
    --ai: #21262d; --nav-bg: rgba(13,17,23,0.98); --header-bg: rgba(13,17,23,0.95);
    --shadow: none;
}

body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; -webkit-tap-highlight-color: transparent; transition: background 0.3s, color 0.3s; }

/* Layout */
.page { display:none; flex:1; flex-direction:column; overflow:hidden; position:relative; }
.page.active { display:flex; }
nav { height: 55px; background: var(--nav-bg); border-top: 1px solid var(--border); display: flex; z-index: 90; padding-bottom: env(safe-area-inset-bottom); backdrop-filter: blur(10px); }
.nav-item { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; color: var(--text-sub); cursor:pointer; font-size: 0.9rem; }
.nav-item.active { color:var(--accent); font-weight: 600; }

/* Header */
header { padding: 12px 15px; background: var(--header-bg); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 91; padding-top: max(12px, env(safe-area-inset-top)); backdrop-filter: blur(10px); }
.h-btn { background:none; border:none; font-size:1.4rem; cursor:pointer; padding:5px; color:var(--text); transition: opacity 0.2s; }
h1 { margin:0; font-size:1.1rem; font-weight:600; letter-spacing:0.5px; }

/* Chat UI */
#chat-box { flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; gap:20px; background: var(--bg); }
.bubble { padding:12px 16px; border-radius:18px; max-width:88%; line-height:1.6; font-size:1rem; word-wrap:break-word; position:relative; box-shadow: var(--shadow); }
.u-msg { align-self:flex-end; background:var(--user); color:var(--user-text); border-bottom-right-radius:4px; }
.a-msg { align-self:flex-start; background:var(--ai); border:1px solid var(--border); color: var(--text); border-bottom-left-radius:4px; padding-bottom:28px; }
.bubble img { max-width:100%; border-radius:8px; margin-top:8px; display:block; border: 1px solid rgba(0,0,0,0.1); }

/* Time & Context Menu */
.time { display: block; font-size: 0.7rem; color: var(--text-sub); margin-top: 5px; opacity: 0.7; text-align: right; pointer-events: none; }
.u-msg .time { color: rgba(255,255,255,0.8); }

#ctx-menu { display:none; position:fixed; background:var(--card); border:1px solid var(--border); border-radius:8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index:1000; padding:5px 0; min-width:140px; animation: fadeIn 0.1s; }
.ctx-item { padding:12px 15px; font-size:0.9rem; cursor:pointer; color:var(--text); transition: background 0.2s; display:flex; align-items:center; gap:8px; }
.ctx-item:hover { background: var(--accent-bg); color: var(--accent); }

/* Input Area */
#input-area { padding:10px; background:var(--card); border-top:1px solid var(--border); display:flex; flex-direction:column; gap:5px; }
.input-row { display:flex; gap:10px; align-items:flex-end; width:100%; }
#u-in { flex:1; background:var(--bg); border:1px solid var(--border); color:var(--text); padding:12px; border-radius:20px; resize:none; height:24px; outline:none; font-family:inherit; font-size: 1rem; max-height: 120px; }
#u-in:focus { border-color: var(--accent); }
.icon-btn { font-size:1.3rem; background:none; border:none; cursor:pointer; padding:0 8px; color:var(--text-sub); line-height:48px; }

/* Previews */
#preview-area { display:none; gap:10px; padding:0 5px; flex-wrap:wrap; margin-bottom: 5px; }
.preview-item { position:relative; background:var(--bg); border:1px solid var(--accent); border-radius:8px; padding:6px 12px; font-size:0.85rem; color:var(--accent); display:flex; align-items:center; gap:8px; }
.preview-img { width:40px; height:40px; object-fit:cover; border-radius:4px; }
.close-prev { cursor:pointer; color:#f85149; font-weight:bold; margin-left:5px; font-size: 1.1rem; }

/* Sidebar & Modal */
#sidebar-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:150; backdrop-filter: blur(2px); }
#sidebar { position:fixed; top:0; left:-280px; width:280px; height:100%; background:var(--card); border-right:1px solid var(--border); transition:left 0.3s; z-index:160; display:flex; flex-direction:column; }
#sidebar.open { left:0; }
.sb-item { padding:12px; margin:5px 10px; border-radius:8px; cursor:pointer; color:var(--text-sub); position:relative; overflow:hidden; }
.sb-item.active { background:var(--accent-bg); color:var(--accent); font-weight:600; }

/* 新增：侧边栏重命名按钮样式 */
.sb-edit { position:absolute; right:35px; top:10px; color:var(--text-sub); background:none; border:none; display:none; font-size:1.1rem; padding: 0 5px; }
.sb-del { position:absolute; right:5px; top:10px; color:#f85149; background:none; border:none; display:none; font-size:1.1rem; padding: 0 5px; }
.sb-item:hover .sb-edit, .sb-item:hover .sb-del { display:block; }

#set-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:200; justify-content:center; align-items:flex-start; overflow-y:auto; backdrop-filter: blur(3px); }
.modal { background:var(--bg); width:90%; margin-top:10vh; padding:25px; border-radius:16px; border:1px solid var(--border); box-sizing:border-box; color: var(--text); }
.inp { width:100%; padding:12px; background:var(--card); border:1px solid var(--border); color:var(--text); border-radius:8px; margin-bottom:12px; outline:none; box-sizing:border-box; }
.btn { padding:10px 14px; border-radius:8px; border:1px solid var(--border); background:var(--card); color:var(--text); cursor:pointer; text-align:center; }
.btn.primary { background:#238636; color: white; border:none; width:100%; padding:12px; font-weight:bold; margin-top:20px; }
.tabs { display:flex; border-bottom:1px solid var(--border); margin-bottom:20px; }
.tab { flex:1; padding:12px; text-align:center; cursor:pointer; color:var(--text-sub); border-bottom:3px solid transparent; }
.tab.active { color:var(--accent); border-bottom-color:var(--accent); font-weight:bold; }
.tab-content { display:none; } .tab-content.active { display:block; }

.clock-row { display:flex; gap:10px; padding:15px; background:var(--card); border-bottom:1px solid var(--border); }
.clock { flex:1; text-align:center; padding:12px; background:var(--bg); border-radius:12px; border:1px solid var(--border); box-shadow: var(--shadow); }
.evt { background:var(--card); border:1px solid var(--border); border-radius:10px; padding:15px; margin-bottom:12px; position:relative; }

label { display: block; margin-bottom: 5px; font-size: 0.85rem; color: var(--text-sub); font-weight: 500; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }